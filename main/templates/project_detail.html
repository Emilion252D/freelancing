{% extends 'base.html' %}
{% block title %}{{ project.title }}{% endblock %}

{% block content %}
<div class="card shadow-sm p-4 mb-4">
    <h2 class="mb-3">{{ project.title }}</h2>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ project.description }}</p>
    <p><strong>–ë—é–¥–∂–µ—Ç:</strong> {{ project.budget }} ‚Ç∏</p>
    <p><strong>–î–µ–¥–ª–∞–π–Ω:</strong> {{ project.deadline }}</p>

    {% if project.executor %}
        <p><strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> {{ project.executor.username }}</p>
    {% endif %}

    {% if request.user == project.client %}
        <div class="d-flex gap-2 mt-3">
            <a class="btn btn-outline-primary" href="{% url 'main:edit_project' project.pk %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a class="btn btn-outline-danger" href="{% url 'main:delete_project' project.pk %}">–£–¥–∞–ª–∏—Ç—å</a>
        </div>

        {% if not project.is_completed %}
            <form method="post" action="{% url 'main:complete_project' project.pk %}" class="mt-2">
                {% csrf_token %}
                <button class="btn btn-outline-success">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            </form>
        {% else %}
            <div class="alert alert-success mt-2">–ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à—ë–Ω.</div>
        {% endif %}
    {% endif %}

{% if project.is_completed and request.user == project.client or request.user == project.executor %}
    {% if request.user == project.client %}
        <a href="{% url 'main:leave_review' user_id=project.executor.id project_id=project.id %}" class="btn btn-warning mt-2">
            ‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
        </a>
    {% elif request.user == project.executor %}
        <a href="{% url 'main:leave_review' user_id=project.client.id project_id=project.id %}" class="btn btn-warning mt-2">
            ‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –∑–∞–∫–∞–∑—á–∏–∫—É
        </a>
    {% endif %}
{% endif %}
</div>

{% if offer_form %}
    <div class="card p-4 mb-4">
        <h4>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫</h4>
        <form method="post">
            {% csrf_token %}
            {{ offer_form.as_p }}
            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∫–ª–∏–∫</button>
        </form>
    </div>
{% elif user.is_authenticated and not project.executor and has_applied %}
    <div class="alert alert-info">–í—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –æ—Ç–∫–ª–∏–∫ –Ω–∞ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç.</div>
{% endif %}

{% if offers %}
    <div class="mt-4">
        <h4>–û—Ç–∫–ª–∏–∫–∏:</h4>
        {% for offer in offers %}
            <div class="card mb-2">
                <div class="card-body">
                    <p>
                        <strong>{{ offer.freelancer.username }}</strong>
                        {% if offer.freelancer.is_client %}
                            <span class="badge bg-info">–ó–∞–∫–∞–∑—á–∏–∫</span>
                        {% elif offer.freelancer.is_freelancer %}
                            <span class="badge bg-success">–§—Ä–∏–ª–∞–Ω—Å–µ—Ä</span>
                        {% endif %}
                        –ø—Ä–µ–¥–ª–æ–∂–∏–ª: <b>{{ offer.proposed_price }} ‚Ç∏</b>
                    </p>
                    <p>{{ offer.proposal_text }}</p>
                    <small class="text-muted">{{ offer.created_at|date:"d.m.Y H:i" }}</small>

                    {% if request.user == project.client and not project.executor %}
                        <form method="post" action="{% url 'main:accept_offer' offer.pk %}">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-success mt-2">–ü—Ä–∏–Ω—è—Ç—å</button>
                        </form>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤.</p>
{% endif %}

{% if can_chat %}
    <a class="btn btn-outline-secondary mt-3" href="{% url 'main:project_chat' project.pk %}">üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç</a>
{% endif %}

<hr>

<h4 class="mt-5">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h4>
{% for comment in comments %}
    <div class="mb-3 border rounded p-3">
        <strong>{{ comment.author.username }}</strong>
        {% if comment.author.is_client %}
            <span class="badge bg-info">–ó–∞–∫–∞–∑—á–∏–∫</span>
        {% elif comment.author.is_freelancer %}
            <span class="badge bg-success">–§—Ä–∏–ª–∞–Ω—Å–µ—Ä</span>
        {% endif %}
        <div class="small text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</div>
        <div>{{ comment.text }}</div>
    </div>
{% empty %}
    <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endfor %}

{% if user.is_authenticated %}
    <div class="card p-4 mt-3">
        <form method="post">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
        </form>
    </div>
{% else %}
    <p><a href="{% url 'main:login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
{% endif %}

<a class="btn btn-secondary mt-3" href="{% url 'main:project_list' %}">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
{% endblock %}



